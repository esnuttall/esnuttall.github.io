api=new Api,api.loadTemplate("previewdialog",function(a){self.dom=$(a),self.logo=getQueryVariable("logo"),self.autodownload=getQueryVariable("autodownload"),self.api=api,self.loading=$(".master-loading"),self.companyName=getQueryVariable("name")?decodeURI(getQueryVariable("name")):!1,$("#TemplateContent").append(self.dom),api.setMenu($("body"),window,document),$("head").append("<title>"+api.dictionary.meta_preview_title+"</title>"),self.dom.find("svg").hide(),self.dom.find(".language").show(),"en"!=api.language.toLowerCase()&&(self.dom.find(".props").show(),self.dom.find(".webselfform").hide()),0==self.autodownload&&(self.dom.find("span[lang='preview_website_title']").html(self.api.dictionary.preview_website_title_first),self.dom.find("span[lang='preview_website_text']").html(self.api.dictionary.preview_website_text_first));var b=$(".language select");api.getLanguageList(function(a){$.each(a,function(a,c){b.append("<option value="+c.code+">"+c.code+"</option>")}),b.val(api.language)}),$(".language select").on("change",function(){var a=$(this).val();self.api.setLanguage(a,function(){self.api.fillTemplateLanguage($("body"))},!0)}),self.dom.find("div.preview img").attr("src",self.api.preview+self.logo+".png?"+Date.now()),self.dom.find(".edit-buttom").on("mouseup",function(){window.location=self.api.editorPage+"?lang="+self.api.language+"&logo="+self.logo}),$.ajax({type:"post",url:self.api.logo+"get",data:JSON.stringify({guid:self.logo}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){if(1==a.status){var b=getthumb(a.obj);self.svg=b.svg,self.paid_plan=a.obj.paid_item_number,self.setActions();var c=a.obj.dominant_color,d=c.replace("1)","0.3)");self.dom.find(".customcolor").css("color",c),self.dom.find(".custombg").css("background-color",c),self.dom.find(".monitor-header, .monitor-menu, .monitor-body, .monitor-footer").css("border-right","1px solid "+d),self.dom.find(".monitor-header, .monitor-menu, .monitor-body, .monitor-footer").css("border-left","1px solid "+d),$(".example-box").slideDown()}else alert(self.api.dictionary.preview_invalid_url),window.location="/"})}),self.downloadhiderrors=function(){self.dom.find(".free-popup-wrapper .error").hide(),self.dom.find(".free-popup-wrapper .name-field").css("border","0px"),self.dom.find(".free-popup-wrapper .email-field").css("border","0px"),self.dom.find(".paid-popup-wrapper .error").hide(),self.dom.find(".paid-popup-wrapper .email-field").css("border","0px")},self.downloadfreenameerror=function(){self.dom.find(".free-popup-wrapper .name-field .error").show(),self.dom.find(".free-popup-wrapper .name-field").css("border","2px solid red"),self.dom.find(".free-popup-wrapper .name-field input").focus()},self.downloadfreemailerror=function(){self.dom.find(".free-popup-wrapper .email-field .error").show(),self.dom.find(".free-popup-wrapper .email-field").css("border","2px solid red"),self.dom.find(".free-popup-wrapper .email-field input").focus()},self.downloadpaidemailerror=function(){self.dom.find(".paid-popup-wrapper .email-field .error").show(),self.dom.find(".paid-popup-wrapper .email-field").css("border","2px solid red"),self.dom.find(".paid-popup-wrapper .email-field input").focus()},self.registerFreeEvent=function(){self.dom.find(".free-popup-box input").keyup(function(a){13==a.keyCode&&self.callfreedownload()}),self.dom.find(".free-popup-wrapper .confirm").unbind("mouseup").on("mouseup",function(){self.callfreedownload()})},self.registerPaidEvent=function(){self.dom.find(".paid-popup-box input").keyup(function(a){13==a.keyCode&&self.callfreedownload()}),self.dom.find(".paid-popup-wrapper .confirm").unbind("mouseup").on("mouseup",function(){self.callpaiddownload()})},self.callfreedownload=function(){self.downloadhiderrors(),""!=self.dom.find(".free-popup-wrapper .name-field input").val().trim()?validateEmail(self.dom.find(".free-popup-wrapper .email-field input").val())?self.downloadfree():self.downloadfreemailerror():self.downloadfreenameerror()},self.callpaiddownload=function(){self.downloadhiderrors(),validateEmail(self.dom.find(".paid-popup-wrapper .email-field input").val())?self.downloadpaid():self.downloadpaidemailerror()},self.startloading=function(){self.loading.fadeIn()},self.endloading=function(){self.loading.hide()},self.startdownload=function(){self.startloading();var a=self.svg.clone(),b=self.svg.clone(),c=self.svg.clone(),d=self.svg.clone();a.wrap("<div></div>"),b.wrap("<div></div>"),c.wrap("<div></div>"),d.wrap("<div></div>"),a.attr("width","5000px"),a.attr("height","5000px"),b.attr("width","200px"),b.attr("height","200px"),c.attr("width","500px"),c.attr("height","500px"),d.attr("width","1000px"),d.attr("height","1000px");var e={};e.big=a.parent().html(),e.small=b.parent().html(),e.mediumsmall=c.parent().html(),e.medium=d.parent().html(),e.guid=self.logo,$.ajax({type:"post",url:self.api.get+"start",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){if(self.endloading(),a){getCookie=function(a){var b="; "+document.cookie,c=b.split("; "+a+"=");return 2==c.length?c.pop().split(";").shift():null};var b=null,c=getCookie("companyname");null!==c&&""!=c&&(b=c);var d=new Messagebox(self,self.api.dictionary.preview_download_message,null,null,self.api.dictionary.ok);d.show();var e=$(".messagebox .message a");self.dom.find("#webselfformframe").attr("src","https://www.webself.net/webselfaffiliate/bannfreelogohorizontal.aspx?lang=en&email="+a.clientemail+(null!=b?"&company="+b:"")),e.attr("id","downloadlink"),e.attr("href",api.download+a.storagename),e.attr("download",api.download+a.storagename),e.attr("target","_blank"),navigator.userAgent.search("Safari")>=0&&navigator.userAgent.search("Chrome")<0?window.location.assign(api.download+a.storagename):e[0].click()}else{var d=new Messagebox(self,self.api.dictionary.error_generic,null,null,self.api.dictionary.ok);d.show()}})},self.downloadfree=function(){self.startloading();var a={};a.name=self.dom.find(".free-popup-wrapper .name-field input").val(),a.email=self.dom.find(".free-popup-wrapper .email-field input").val(),a.guid=self.logo,a.language=api.language,a.os=api.GetOs(),a.browser=api.GetBrowserAndVersion(),$.ajax({type:"post",url:self.api.mail+"free",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(b){if(self.endloading(),1==b.status)self.dom.find("#webselfformframe").attr("src","https://www.webself.net/webselfaffiliate/bannfreelogohorizontal.aspx?lang=en&email="+encodeURI(a.email)+"&company="+encodeURI(self.companyName)),self.dom.find(".free-popup-wrapper .cancel-td").css("visibility","hidden"),self.dom.find(".free-popup-wrapper .name-field").hide(),self.dom.find(".free-popup-wrapper .email-field").hide(),self.dom.find(".free-popup-wrapper .message").empty(),self.dom.find(".free-popup-wrapper .message").append("<span>"+self.api.dictionary.preview_mail_confirmation_1+"</span>"),self.dom.find(".free-popup-wrapper .message").append("<span>"+self.api.dictionary.preview_mail_confirmation_2+"</span>"),self.dom.find(".free-popup-wrapper .message span").css("display","block"),self.dom.find(".free-popup-wrapper .confirm").html(self.api.dictionary.close),self.dom.find(".free-popup-wrapper .confirm").unbind("mouseup").on("mouseup",function(){self.dom.find(".free-popup-wrapper").fadeOut(function(){self.dom.find(".free-popup-wrapper .cancel-td").css("visibility","visible"),self.dom.find(".free-popup-wrapper .name-field").show(),self.dom.find(".free-popup-wrapper .email-field").show(),self.dom.find(".free-popup-wrapper .message").empty(),self.dom.find(".free-popup-wrapper .message").append(self.api.dictionary.preview_mail_message),self.dom.find(".free-popup-wrapper .confirm").html(self.api.dictionary.ok),self.registerFreeEvent()})});else{var c=new Messagebox(self,self.api.dictionary.error_generic,null,null,self.api.dictionary.ok);c.show()}})},self.downloadpaid=function(){self.startloading();var a="EWSKKYWJW3VHL",b="VKEGNZ4UMEKPY";self.dom.find(".paid-popup-wrapper").hasClass("hires")&&(a="4FG2SZULQPWD2",b="JGXZRCPVEASG2");var c="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id="+a+"&custom="+self.logo+"|"+api.language+"|"+self.dom.find(".paid-popup-wrapper .email-field input").val()+"|"+api.GetOs()+"|"+api.GetBrowserAndVersion()+"&return="+self.api.protocol+self.api.language+"."+self.api.base+"/success.html&cancel_return="+self.api.protocol+self.api.language+"."+self.api.base+"/cancel.html&rm=1&cbt="+self.api.dictionary.paypal_message;window.location=c},self.setActions=function(){"201"==self.paid_plan||"301"==self.paid_plan?(self.dom.find(".vector-buttom").html(self.api.dictionary.download),self.dom.find(".download-vector-box").on("mouseup",function(){self.startdownload()}),self.dom.find(".highres-buttom").remove(),self.dom.find(".free-buttom").remove()):(self.dom.find(".vector-buttom").html(self.api.dictionary.buy),self.dom.find(".download-vector-box").on("mouseup",function(){self.downloadhiderrors(),self.dom.find(".paid-popup-wrapper .email-field input").val(""),self.dom.find(".paid-popup-wrapper").fadeIn(300).addClass("vector"),self.dom.find(".paid-popup-wrapper .paid-popup-box").center(),self.registerPaidEvent(),self.dom.find(".paid-popup-wrapper .close, .paid-popup-wrapper .cancel").on("mouseup",function(){self.dom.find(".paid-popup-wrapper").fadeOut()})}),"101"==self.paid_plan?(self.dom.find(".highres-buttom").html(self.api.dictionary.download),self.dom.find(".download-highres-box").on("mouseup",function(){self.startdownload()}),self.dom.find(".free-buttom").remove()):(self.dom.find(".highres-buttom").html(self.api.dictionary.buy),self.dom.find(".download-highres-box").on("mouseup",function(){self.downloadhiderrors(),self.dom.find(".paid-popup-wrapper .email-field input").val(""),self.dom.find(".paid-popup-wrapper").fadeIn(300).addClass("hires"),self.dom.find(".paid-popup-wrapper .paid-popup-box").center(),self.registerPaidEvent(),self.dom.find(".paid-popup-wrapper .close, .paid-popup-wrapper .cancel").on("mouseup",function(){self.dom.find(".paid-popup-wrapper").fadeOut()})}),self.dom.find(".free-buttom").html(self.api.dictionary.download),"0"==self.paid_plan?self.dom.find(".download-free-box").on("mouseup",function(){self.startdownload()}):(self.dom.find(".free-popup-wrapper .close, .free-popup-wrapper .cancel").on("mouseup",function(){self.dom.find(".free-popup-wrapper").fadeOut()}),self.registerFreeEvent(),self.dom.find(".download-free-box").on("click",function(){self.downloadhiderrors(),self.dom.find(".free-popup-wrapper .name-field input").val(""),self.dom.find(".free-popup-wrapper .email-field input").val(""),self.dom.find(".free-popup-wrapper").fadeIn(300),self.dom.find(".free-popup-wrapper .free-popup-box").center()})))),self.autodownload&&self.startdownload()};